#Template to install prerequisites for running any fluttter items.
parameters:
- name: flutter_version
  default: stable
- name: flutter_pkg
  default: 'luna_core'

steps:

- script: |
    git clone https://github.com/flutter/flutter.git -b ${{ parameters.flutter_version }}
    echo "##vso[task.prependpath]`pwd`/flutter/bin"
  displayName: 'Install Flutter SDK'
  condition: ne( variables['Agent.OS'], 'Windows_NT' )

- script: |
    cd ${{ parameters.flutter_pkg }}
    flutter pub get
    flutter pub global activate junitreport
    flutter pub global activate cobertura
    flutter pub global activate patrol_cli
    echo "##vso[task.prependpath]$HOME/.pub-cache/bin"
  displayName: 'Activate Flutter Packages'
  condition: ne( variables['Agent.OS'], 'Windows_NT' )

#while bash scripts are available on windows, there are subtle differences that make just using powershell easier for this task
- powershell: |
    git clone https://github.com/flutter/flutter.git -b ${{ parameters.flutter_version }} $(System.DefaultWorkingDirectory)/flutter
    Write-Host "##vso[task.prependpath]$(System.DefaultWorkingDirectory)/flutter/bin"
  condition: eq( variables['Agent.OS'], 'Windows_NT' )
  displayName: 'Install Flutter SDK (Windows)'

#"C:\Users\VssAdministrator\AppData\" is the localation on Windows Microsoft hosted agents for AppData.
##That is a different directory that Agent.HomeDirectory
- powershell: |
    cd ${{ parameters.flutter_pkg }}
    flutter pub get
    flutter pub global activate junitreport
    flutter pub global activate cobertura
    Write-Host "##vso[task.prependpath]C:\Users\VssAdministrator\AppData\Local\Pub\Cache\bin"
  condition: eq( variables['Agent.OS'], 'Windows_NT' )
  displayName: 'Activate Flutter Packages (Windows)'

- task: JavaToolInstaller@0
  inputs:
    versionSpec: '17'
    jdkArchitectureOption: 'x64'
    jdkSourceOption: 'PreInstalled'

