# Template to build out the luna mobile app
# end result of this template is a .apk file for the luna app
# file location should be build\app\outputs\flutter-apk\app-release.apk
parameters:
- name: build_os  # operating system for which to build
  default: 'android'
- name: build_name
  default: 0
- name: archive_file
  default: true
- name: package_name
  default: MobileBuild
- name: target_dir # directory where zip file will be placed
  default: '.'
  
steps:

- task: PowerShell@2
  displayName: 'Build Flutter ${{ parameters.build_os }} App'
  condition: succeededOrFailed()
  inputs:
    targetType: 'inline'
    script: |
      cd "luna_mobile"
      flutter clean
      flutter pub get
      flutter create --platforms=${{ parameters.build_os }} .
      flutter build apk --build-name ${{  parameters.build_name  }}

- task: ArchiveFiles@2
  condition: ${{ parameters.archive_file }}
  inputs:
    rootFolderOrFile: "$(Build.SourcesDirectory)/luna_mobile/build/app/outputs/flutter-apk/app-release.apk"
    archiveType: 'zip'
    archiveFile: "${{ parameters.target_dir }}/${{ parameters.package_name }}.zip"
