# Lint and Testing pipeline for Luna mHealth
# YML that gets run when a PR is requested
trigger: none

pool:
  vmImage: windows-latest

variables:
  - name: package_folders
    value: luna_core,luna_authoring_system,luna_mobile

steps:

- template: ../templates/install_prereqs.yml

- ${{ each folder in split(variables.package_folders, ',') }}:
  - template: ../templates/lint_luna.yml
    parameters:
      package_path: ${{ folder }}
      package_name: ${{ folder }}
  - template: ../templates/run_tests.yml
    parameters:
      package_path: ${{ folder }}
      package_name: ${{ folder }}
      include_coverage: 'true'

- template: ../templates/test_file_existence.yml

- template: ../templates/publish_test_lint_results.yml
  parameters:
    include_coverage: 'true'
