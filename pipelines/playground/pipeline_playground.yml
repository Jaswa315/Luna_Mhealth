# Nightly Build for Luna mHealth
# Runs unit tests and then integration tests

trigger: none

pool:
  vmImage: macos-latest
variables:
  - name: package_folders
    value: luna_core,luna_authoring_system,luna_mobile

steps:

- template: ../templates/install_prereqs.yml

- ${{ each folder in split(variables.package_folders, ',') }}:
  - template: ../templates/lint_luna.yml
    parameters:
      package_path: ${{ folder }}
      package_name: ${{ folder }}
  - template: ../templates/run_tests.yml
    parameters:
      package_path: ${{ folder }}
      package_name: ${{ folder }}

- template: ../templates/publish_test_lint_results.yml

- template: ../templates/run_luna_authoring.yml
  parameters:
    operating_system: macos