# Nightly Build for Luna mHealth
trigger: none
schedules:
- cron: '0 10 * * *' #10:00 AM UTC
  displayName: Daily 3:00AM PST build
  branches:
    include:
    - main

strategy:
  matrix:
    linux:
      imageName: 'ubuntu-latest'
    mac:
      imageName: 'macOS-latest'
    windows:
      imageName: 'windows-latest'

pool:
  vmImage: $(imageName)

variables:
  - name: package_folders
    value: luna_core,luna_authoring_system,luna_mobile

steps:

- template: templates/install_prereqs.yml

- ${{ each folder in split(variables.package_folders, ',') }}:
  - template: templates/lint_luna.yml
    parameters:
      package_path: ${{ folder }}
      package_name: ${{ folder }}
  - template: templates/run_tests.yml
    parameters:
      package_path: ${{ folder }}
      package_name: ${{ folder }}

- template: templates/publish_test_lint_results.yml
