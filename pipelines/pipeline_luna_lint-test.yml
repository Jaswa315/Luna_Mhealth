# Lint and Testing pipeline for Luna mHealth
# YML that gets run when a PR is requested
trigger: none

pool:
  vmImage: windows-latest

variables:
  - name: package_folders
    value: luna_core,luna_authoring_system,luna_mobile

steps:

- template: templates/install_prereqs.yml

- ${{ each folder in split(variables.package_folders, ',') }}:
  - template: templates/lint_luna.yml
    parameters:
      package_path: ${{ folder }}
      package_name: ${{ folder }}
  - template: templates/run_tests.yml
    parameters:
      package_path: ${{ folder }}
      package_name: ${{ folder }}
      include_coverage: 'false'
      test_file_name: "$(Build.SourcesDirectory)/${{ folder }}/test/all_tests.dart"

# Check for existence of the license file
- template: templates/test_file_existence.yml

- template: templates/build_authoring_system.yml
  parameters:
    build_os: windows
    package_name: windows-temp-build
    release_directory: /x64/runner/Debug
    build_name: windows-temp-build
    debug_mode: true
    archive_file: false

- template: templates/run_luna_authoring.yml
  parameters:
    operating_system: windows
    use_built_exe: true
    release_dir: /x64/runner/Debug

- template: templates/publish_test_lint_results.yml
